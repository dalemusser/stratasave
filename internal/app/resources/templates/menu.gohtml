{{/* Menu dispatcher - choose role-specific menu at runtime */}}
{{ define "menu" }}
  {{ if eq .Role "admin" }}
    {{ template "menu_admin" . }}
  {{ else if .IsLoggedIn }}
    {{ template "menu_user" . }}
  {{ else }}
    {{ template "menu_visitor" . }}
  {{ end }}
{{ end }}

{{/* Admin Menu */}}
{{ define "menu_admin" }}
<div class="mb-2">
  <div class="flex flex-col items-center">
    {{ if .LogoURL }}
      <img src="{{ .LogoURL }}" alt="{{ .SiteName }}" class="h-10 w-auto">
    {{ end }}
    <h1 class="menu-header text-xl font-bold text-indigo-600 dark:text-indigo-400">{{ if .SiteName }}{{ .SiteName }}{{ else }}StrataForge{{ end }}</h1>
  </div>
</div>

<nav class="space-y-2 text-sm flex-1 pt-4 border-t border-gray-200 dark:border-gray-700">
  <a class="menu-link flex items-center text-gray-700 dark:text-gray-300 hover:text-indigo-600 dark:hover:text-indigo-400" href="/dashboard" title="Dashboard"><span class="menu-icon mr-2">ğŸ›ï¸</span><span class="menu-text">Dashboard</span></a>
  <a class="menu-link flex items-center text-gray-700 dark:text-gray-300 hover:text-indigo-600 dark:hover:text-indigo-400" href="/system-users" title="System Users"><span class="menu-icon mr-2">ğŸ‘¥</span><span class="menu-text">System Users</span></a>
  <a class="menu-link flex items-center text-gray-700 dark:text-gray-300 hover:text-indigo-600 dark:hover:text-indigo-400" href="/invitations" title="Invitations"><span class="menu-icon mr-2">ğŸ“¨</span><span class="menu-text">Invitations</span></a>
  <a class="menu-link flex items-center text-gray-700 dark:text-gray-300 hover:text-indigo-600 dark:hover:text-indigo-400" href="/announcements" title="Announcements"><span class="menu-icon mr-2">ğŸ“¢</span><span class="menu-text">Announcements</span></a>
  <a class="menu-link flex items-center text-gray-700 dark:text-gray-300 hover:text-indigo-600 dark:hover:text-indigo-400" href="/library" title="Library"><span class="menu-icon mr-2">ğŸ“</span><span class="menu-text">Library</span></a>
  <a class="menu-link flex items-center text-gray-700 dark:text-gray-300 hover:text-indigo-600 dark:hover:text-indigo-400" href="/audit" title="Audit Log"><span class="menu-icon mr-2">ğŸ“‹</span><span class="menu-text">Audit Log</span></a>
  <a class="menu-link flex items-center text-gray-700 dark:text-gray-300 hover:text-indigo-600 dark:hover:text-indigo-400" href="/dashboard/sessions" title="Active Sessions"><span class="menu-icon mr-2">ğŸ–¥ï¸</span><span class="menu-text">Sessions</span></a>
  <a class="menu-link flex items-center text-gray-700 dark:text-gray-300 hover:text-indigo-600 dark:hover:text-indigo-400" href="/activity" title="Activity Dashboard"><span class="menu-icon mr-2">ğŸ“Š</span><span class="menu-text">Activity</span></a>
  <a class="menu-link flex items-center text-gray-700 dark:text-gray-300 hover:text-indigo-600 dark:hover:text-indigo-400" href="/ledger" title="Request Ledger"><span class="menu-icon mr-2">ğŸ“</span><span class="menu-text">Ledger</span></a>
  <a class="menu-link flex items-center text-gray-700 dark:text-gray-300 hover:text-indigo-600 dark:hover:text-indigo-400" href="/api-keys" title="API Keys"><span class="menu-icon mr-2">ğŸ”‘</span><span class="menu-text">API Keys</span></a>
  <a class="menu-link flex items-center text-gray-700 dark:text-gray-300 hover:text-indigo-600 dark:hover:text-indigo-400" href="/jobs" title="Job Queue"><span class="menu-icon mr-2">âš¡</span><span class="menu-text">Jobs</span></a>
  <a class="menu-link flex items-center text-gray-700 dark:text-gray-300 hover:text-indigo-600 dark:hover:text-indigo-400" href="/stats" title="Statistics"><span class="menu-icon mr-2">ğŸ“ˆ</span><span class="menu-text">Stats</span></a>
  <a class="menu-link flex items-center text-gray-700 dark:text-gray-300 hover:text-indigo-600 dark:hover:text-indigo-400" href="/admin/status" title="System Status"><span class="menu-icon mr-2">ğŸ”§</span><span class="menu-text">Status</span></a>
  {{ template "menu_common" . }}
</nav>

{{ if .IsLoggedIn }}
  <a href="/profile" class="menu-user-info block mt-4 pt-4 border-t border-b border-gray-200 dark:border-gray-700 text-xs hover:bg-gray-100 dark:hover:bg-gray-700 -mx-2 px-2" style="padding-bottom: 1rem;" title="View Profile">
    <div class="font-semibold truncate text-gray-700 dark:text-gray-300">{{ .UserName }}</div>
    <div class="text-gray-500 dark:text-gray-500">{{ .Role }}</div>
  </a>
{{ template "menu_footer_no_border" }}
{{ else }}
{{ template "menu_footer" }}
{{ end }}
{{ end }}

{{/* Regular User Menu */}}
{{ define "menu_user" }}
<div class="mb-2">
  <div class="flex flex-col items-center">
    {{ if .LogoURL }}
      <img src="{{ .LogoURL }}" alt="{{ .SiteName }}" class="h-10 w-auto">
    {{ end }}
    <h1 class="menu-header text-xl font-bold text-indigo-600 dark:text-indigo-400">{{ if .SiteName }}{{ .SiteName }}{{ else }}StrataForge{{ end }}</h1>
  </div>
</div>

<nav class="space-y-2 text-sm flex-1 pt-4 border-t border-gray-200 dark:border-gray-700">
  <a class="menu-link flex items-center text-gray-700 dark:text-gray-300 hover:text-indigo-600 dark:hover:text-indigo-400" href="/dashboard" title="Dashboard"><span class="menu-icon mr-2">ğŸ›ï¸</span><span class="menu-text">Dashboard</span></a>
  <a class="menu-link flex items-center text-gray-700 dark:text-gray-300 hover:text-indigo-600 dark:hover:text-indigo-400" href="/my-announcements" title="Announcements"><span class="menu-icon mr-2">ğŸ“¢</span><span class="menu-text">Announcements</span></a>
  <a class="menu-link flex items-center text-gray-700 dark:text-gray-300 hover:text-indigo-600 dark:hover:text-indigo-400" href="/library" title="Library"><span class="menu-icon mr-2">ğŸ“</span><span class="menu-text">Library</span></a>
  {{ if eq .Role "developer" }}
  <a class="menu-link flex items-center text-gray-700 dark:text-gray-300 hover:text-indigo-600 dark:hover:text-indigo-400" href="/ledger" title="Request Ledger"><span class="menu-icon mr-2">ğŸ“</span><span class="menu-text">Ledger</span></a>
  <a class="menu-link flex items-center text-gray-700 dark:text-gray-300 hover:text-indigo-600 dark:hover:text-indigo-400" href="/jobs" title="Job Queue"><span class="menu-icon mr-2">âš¡</span><span class="menu-text">Jobs</span></a>
  <a class="menu-link flex items-center text-gray-700 dark:text-gray-300 hover:text-indigo-600 dark:hover:text-indigo-400" href="/stats" title="Statistics"><span class="menu-icon mr-2">ğŸ“ˆ</span><span class="menu-text">Stats</span></a>
  {{ end }}
  {{ template "menu_common" . }}
</nav>

{{ if .IsLoggedIn }}
  <a href="/profile" class="menu-user-info block mt-4 pt-4 border-t border-b border-gray-200 dark:border-gray-700 text-xs hover:bg-gray-100 dark:hover:bg-gray-700 -mx-2 px-2" style="padding-bottom: 1rem;" title="View Profile">
    <div class="font-semibold truncate text-gray-700 dark:text-gray-300">{{ .UserName }}</div>
    <div class="text-gray-500 dark:text-gray-500">{{ .Role }}</div>
  </a>
{{ template "menu_footer_no_border" }}
{{ else }}
{{ template "menu_footer" }}
{{ end }}
{{ end }}

{{/* Visitor Menu (not logged in) */}}
{{ define "menu_visitor" }}
<div class="mb-2">
  <div class="flex flex-col items-center">
    {{ if .LogoURL }}
      <img src="{{ .LogoURL }}" alt="{{ .SiteName }}" class="h-10 w-auto">
    {{ end }}
    <h1 class="menu-header text-xl font-bold text-indigo-600 dark:text-indigo-400">{{ if .SiteName }}{{ .SiteName }}{{ else }}StrataForge{{ end }}</h1>
  </div>
</div>

<nav class="space-y-2 text-sm flex-1 pt-4 border-t border-gray-200 dark:border-gray-700">
  {{ template "menu_common" . }}
</nav>

{{ template "menu_footer" }}
{{ end }}

{{/* Shared menu links */}}
{{ define "menu_common" }}
  <a class="menu-link flex items-center text-gray-700 dark:text-gray-300 hover:text-indigo-600 dark:hover:text-indigo-400" href="/about" title="About"><span class="menu-icon mr-2">â„¹ï¸</span><span class="menu-text">About</span></a>
  <a class="menu-link flex items-center text-gray-700 dark:text-gray-300 hover:text-indigo-600 dark:hover:text-indigo-400" href="/contact" title="Contact"><span class="menu-icon mr-2">ğŸ“§</span><span class="menu-text">Contact</span></a>
  <a class="menu-link flex items-center text-gray-700 dark:text-gray-300 hover:text-indigo-600 dark:hover:text-indigo-400" href="/terms" title="Terms of Service"><span class="menu-icon mr-2">ğŸ“œ</span><span class="menu-text">Terms</span></a>
  <a class="menu-link flex items-center text-gray-700 dark:text-gray-300 hover:text-indigo-600 dark:hover:text-indigo-400" href="/privacy" title="Privacy Policy"><span class="menu-icon mr-2">ğŸ”’</span><span class="menu-text">Privacy</span></a>

  {{ if .IsLoggedIn }}
    <a class="menu-link flex items-center text-gray-700 dark:text-gray-300 hover:text-indigo-600 dark:hover:text-indigo-400" href="/profile" title="Profile"><span class="menu-icon mr-2">ğŸ‘¤</span><span class="menu-text">Profile</span></a>
    {{ if eq .Role "admin" }}
      <a class="menu-link flex items-center text-gray-700 dark:text-gray-300 hover:text-indigo-600 dark:hover:text-indigo-400" href="/settings" title="Workspace Settings"><span class="menu-icon mr-2">âš™ï¸</span><span class="menu-text">Settings</span></a>
    {{ end }}
    <a class="menu-link flex items-center text-red-500 dark:text-red-400 hover:underline" href="/logout" title="Logout"><span class="menu-icon mr-2">ğŸšª</span><span class="menu-text">Logout</span></a>
  {{ else }}
    <a class="menu-link flex items-center text-gray-700 dark:text-gray-300 hover:text-indigo-600 dark:hover:text-indigo-400" href="/login" title="Login"><span class="menu-icon mr-2">ğŸ”</span><span class="menu-text">Login</span></a>
  {{ end }}
{{ end }}

{{/* Footer with dark mode and collapse toggle */}}
{{ define "menu_footer" }}
<div class="mt-4 pt-4 border-t border-gray-200 dark:border-gray-700 space-y-2">
  <button id="dark-mode-toggle" class="menu-link flex items-center text-gray-500 dark:text-gray-400 hover:text-indigo-600 dark:hover:text-indigo-400 text-sm w-full" title="Toggle dark mode">
    <span class="menu-icon mr-2" id="dark-mode-icon">ğŸŒ™</span><span class="menu-text" id="dark-mode-text">Dark Mode</span>
  </button>
  <button id="menu-toggle" class="menu-link flex items-center text-gray-500 dark:text-gray-400 hover:text-indigo-600 dark:hover:text-indigo-400 text-sm w-full" title="Toggle sidebar">
    <span class="menu-icon mr-2">â—€</span><span class="menu-text">Collapse</span>
  </button>
</div>
{{ end }}

{{/* Footer without top border (used after user info which has bottom border) */}}
{{ define "menu_footer_no_border" }}
<div class="pt-4 space-y-2">
  <button id="dark-mode-toggle" class="menu-link flex items-center text-gray-500 dark:text-gray-400 hover:text-indigo-600 dark:hover:text-indigo-400 text-sm w-full" title="Toggle dark mode">
    <span class="menu-icon mr-2" id="dark-mode-icon">ğŸŒ™</span><span class="menu-text" id="dark-mode-text">Dark Mode</span>
  </button>
  <button id="menu-toggle" class="menu-link flex items-center text-gray-500 dark:text-gray-400 hover:text-indigo-600 dark:hover:text-indigo-400 text-sm w-full" title="Toggle sidebar">
    <span class="menu-icon mr-2">â—€</span><span class="menu-text">Collapse</span>
  </button>
</div>
{{ end }}
